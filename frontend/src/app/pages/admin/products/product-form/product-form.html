<!-- product-form.html -->
<div class="product-form-container">
  <!-- Header -->
  <div class="header-section">
    <h1>{{ isEdit ? 'Edit Product' : 'Add New Product' }}</h1>
    <button class="btn btn-secondary" routerLink="/admin/product">
      ‚Üê Back to Products
    </button>
  </div>

  <!-- Messages -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{errorMessage}}
  </div>
  <div *ngIf="successMessage" class="alert alert-success">
    {{successMessage}}
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-section">
    <div class="spinner"></div>
    <p>Loading {{ isEdit ? 'product' : 'categories' }}...</p>
  </div>

  <!-- Product Form -->
  <form *ngIf="!loading" [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
    <div class="form-columns">
      <!-- Left Column - Basic Info -->
      <div class="form-column">
        <h3>Basic Information</h3>

        <!-- Product Name -->
        <div class="form-group">
          <label for="name">Product Name *</label>
          <input
            type="text"
            id="name"
            formControlName="name"
            class="form-control"
            placeholder="Enter product name"
            [class.error]="formControls['name'].touched && formControls['name'].invalid"
          />
          <div *ngIf="formControls['name'].touched && formControls['name'].invalid" class="error-message">
            <span *ngIf="formControls['name'].errors?.['required']">Product name is required</span>
            <span *ngIf="formControls['name'].errors?.['minlength']">Product name must be at least 2 characters</span>
          </div>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description">Description *</label>
          <textarea
            id="description"
            formControlName="description"
            class="form-control"
            rows="4"
            placeholder="Enter product description"
            [class.error]="formControls['description'].touched && formControls['description'].invalid"
          ></textarea>
          <div *ngIf="formControls['description'].touched && formControls['description'].invalid" class="error-message">
            <span *ngIf="formControls['description'].errors?.['required']">Description is required</span>
            <span *ngIf="formControls['description'].errors?.['minlength']">Description must be at least 10 characters</span>
          </div>
        </div>

        <!-- Price & Stock -->
        <div class="form-row">
          <div class="form-group">
            <label for="price">Price ($) *</label>
            <input
              type="number"
              id="price"
              formControlName="price"
              class="form-control"
              min="0"
              step="0.01"
              placeholder="0.00"
              [class.error]="formControls['price'].touched && formControls['price'].invalid"
            />
            <div *ngIf="formControls['price'].touched && formControls['price'].invalid" class="error-message">
              Valid price is required
            </div>
          </div>

          <div class="form-group">
            <label for="stock">Stock Quantity *</label>
            <input
              type="number"
              id="stock"
              formControlName="stock"
              class="form-control"
              min="0"
              placeholder="0"
              [class.error]="formControls['stock'].touched && formControls['stock'].invalid"
            />
            <div *ngIf="formControls['stock'].touched && formControls['stock'].invalid" class="error-message">
              Stock quantity is required
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Categories & Image -->
      <div class="form-column">
        <h3>Categories & Image</h3>

        <!-- Category -->
        <div class="form-group">
          <label for="category">Category *</label>
          <select
            id="category"
            formControlName="category"
            class="form-control"
            [class.error]="formControls['category'].touched && formControls['category'].invalid"
          >
            <option value="">Select a category</option>
            <option *ngFor="let category of categories" [value]="category._id">
              {{category.name}}
            </option>
          </select>
          <div *ngIf="formControls['category'].touched && formControls['category'].invalid" class="error-message">
            Category is required
          </div>
        </div>

        <!-- Subcategory -->
        <div class="form-group">
          <label for="subcategory">Subcategory (Optional)</label>
          <select
            id="subcategory"
            formControlName="subcategory"
            class="form-control"
            [disabled]="!productForm.get('category')?.value"
          >
            <option value="">Select a subcategory</option>
            <option *ngFor="let subcategory of subcategories" [value]="subcategory._id">
              {{subcategory.name}}
            </option>
          </select>
          <div *ngIf="!productForm.get('category')?.value" class="help-text">
            Select a category first to see subcategories
          </div>
        </div>

        <!-- Image Upload -->
        <div class="form-group">
          <label for="image">Product Image</label>
          <div class="image-upload-container">
            <!-- Image Preview -->
            <div *ngIf="imagePreview" class="image-preview">
              <img [src]="imagePreview" alt="Product preview" class="preview-image" />
              <button type="button" class="btn-remove-image" (click)="removeImage()">√ó</button>
            </div>

            <!-- Upload Area -->
            <div class="upload-area" [class.has-image]="imagePreview">
              <input
                type="file"
                id="image"
                (change)="onFileSelected($event)"
                accept="image/*"
                class="file-input"
              />
              <label for="image" class="upload-label">
                <span class="upload-icon">üì∑</span>
                <span class="upload-text">
                  {{ imagePreview ? 'Change Image' : 'Upload Product Image' }}
                </span>
                <span class="upload-hint">JPEG, PNG, WebP (Max 2MB)</span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        routerLink="/admin/product"
        [disabled]="submitting"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="productForm.invalid || submitting"
      >
        <span *ngIf="submitting" class="spinner-small"></span>
        {{ submitting ? 'Saving...' : (isEdit ? 'Update Product' : 'Create Product') }}
      </button>
    </div>
  </form>
</div>
